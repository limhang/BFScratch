# BFElementEvaluate模块说明文档

该模块负责智能选取网页元素，支持网页`主体内容`，`图片`，等信息选取

---

## 主体内容，选取原理
下面主要介绍，主体内容的获取原理。
### 评分系统
我们认为主体部分，一定都是放在`div`标签之中，所有我们获取到root下面的所有div标签，得到一个div组成的标签列表。
然后，我们针对每一个div标签，进行可能性（主体部分）预估。这里引入一个打分系统。得分最高的，就是我们认为的主体元素部分。打分的判断标准如下：

> 这里面的参数配置，其实很多都没一个确定值，所以我们将这个模块，设置为外界可配置的，这样就可以针对每一个网站，用户来自定义参数。当然，内部我们也会集成最可能的配置方案，当用户不配置时候，我们采用默认配置。下面的默认配置，是仔细思考调研的结果，并不是拍脑袋想的

|编号|名称|分值|权重|
| :--- | :----: | :----: | :----: |
|1|字符数量|字符量 * 0.5|1|
|2|含有`p`标签数量|个数 * 1|1|
|3|含有`h2`,`h3`,`h4`标签数量|个数 * 1|1|
|4|含有`script`标签数量| `-`个数 * 5|1|
|5|含有`<meta`标签数量|`-`个数 * 10|1|
|6|含有`<a>`标签数量|`-`个数 * 3|1|

每一项，都会经过一个函数，当成一个筛选过程，最终分成多轮竞选。上面表格只是打比方，具体参数，看👇

可以将这个过程，看成人大选举。

#### 初定候选人
对root使用xpath选出div数组，数组中每一个div元素都是一个候选人。

#### 初选
将候选人node转化为纯文本字符串，如果转化后的纯文本中，没有`</p>`则，直接筛选掉

#### 第一轮竞选
将候选人node转化为纯文本字符串后，去除`<xxx>`,`</xx>`字符。我们仔细思考一下，如果去除html标签之后，剩下的字符还有什么？常见的`a`,`p`,`span`,`h1`,`h2`,`img`这个tag没有了`<>`还有什么，对基本什么都没有。这里我们需要一个满分标准，我们设定，如果处理后的字符的长度有`400`字，那么我们认为该候选人，拿到该轮竞选满分。

> 高考我们写作文不都是800字嘛，-_-，折个半，就是`400`。其实，研究了很多网站，发现`400`是很合理的，以后有空也可以做机器学习，来做合理值预算。

`计算公式：length(大于400则直接满分，不计算) / 400 * 100 * 0.7(0.7为权重)`

#### 第二轮竞选
使用候选人的node，计算其中包含的node元素个数。
我们认为，主体部分，应该有较多的node元素，而主体的外部包裹层，具有的node元素应该没有主体多，所以我们设置了第二轮竞选。满分我们设置为10个node元素。

`计算公式：node.number(多于10个直接满分，不计算) * 10 * 0.15(0.15为权重)`

#### 第三轮竞选
使用候选人的node，计算其中包含的`</p>`元素个数。
第三轮竞选和第二轮有很多类似的地方，但是这一轮主要比下去，那些有很多比如`</a>`标签，但是并不是主体的部分。
满分我们认为有6个`</p>`标签

`计算公式：node.p.number(多于6个直接满分，不计算) * 100 / 6 * 0.15(0.15为权重)`

#### 第四轮竞选 -- (半决赛，取前几轮中8强)
半决赛，这里我们给8强统一赋值`100`分，如果8强node字符串中含有`<script>`元素，有一个扣分4分，有一个`<meta>`扣分6分。如果有`<p>`加3分，有`h2`加7分。

#### 第五轮竞选 -- （决赛，取半决赛中3强）
在这个时候，已经选定了3强，获取3强node的原始信息，转为text，比较length，谁长就选谁。
最后那个最长的，就是我们的main_content. -_-



